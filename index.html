<script>
// === SUBSTITUEIX AQUESTA FUNCIÓ pel bloc següent ===
async function carregarViatges(){
  const msg = document.getElementById('msg-viatges');
  try{
    const resp = await fetch('viatges/viatges.json?cacheBust=' + Date.now(), { cache: 'no-store' });
    if(!resp.ok) throw new Error('HTTP ' + resp.status);
    const viatges = await resp.json();
    renderViatges(Array.isArray(viatges) ? viatges : []);
  }catch(e){
    console.error('Error carregant viatges:', e);
    renderViatges([]); // Fallback visual
    msg.style.display = 'block';
  }
}

// === AFEGEIX AQUEST AJUDANT (just després de la funció anterior) ===
function renderViatges(viatges){
  const container = document.getElementById('carousel');
  const msg = document.getElementById('msg-viatges');
  container.innerHTML = '';

  const MAX_VIATGES = 12;
  const llista = (viatges || [])
    .filter(v => v && v.path)   // si vols, treu el filtre ‘arxivats’ de la versió antiga
    .slice(0, MAX_VIATGES);

  if (llista.length === 0) {
    // Targeta de fallback perquè no quedi en blanc
    const info = document.createElement('div');
    info.className = 'card';
    info.innerHTML = `
      <div style="height:200px;display:grid;place-items:center;border:1px dashed #cfd8d3;border-radius:var(--radius)">
        Properament noves sortides
      </div>
      <h3>Estigues atent</h3>
      <p>Actualitzarem els viatges ben aviat.</p>`;
    container.appendChild(info);
    msg.style.display = 'block';
  } else {
    llista.forEach(v => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <a href="${v.path}">
          <img loading="lazy" decoding="async" src="${v.imatge}" alt="${v.titol}">
        </a>
        <h3>${v.titol}</h3>
        <p>${v.dates || ''}</p>`;
      container.appendChild(card);
    });
    msg.style.display = 'none';
  }
  updateArrows();
}
</script>
